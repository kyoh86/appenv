// Code generated by github.com/kyoh86/appenv.Generator DO NOT EDIT.

package out

import (
	"io"

	"github.com/99designs/keyring"
	def "github.com/kyoh86/appenv/internal/def"
)

func GetAccess(yamlReader io.Reader, keyringConfig *keyring.Config, envarPrefix string) (access Access, err error) {
	yml, err := loadYAML(yamlReader)
	if err != nil {
		return access, err
	}
	keyring, err := loadKeyring(keyringConfig)
	if err != nil {
		return access, err
	}
	return buildAccess(yml, keyring, envarPrefix)
}

func buildAccess(yml YAML, keyring Keyring, envarPrefix string) (access Access, err error) {
	envar, err := getEnvar(envarPrefix)
	if err != nil {
		return access, err
	}
	access.token = new(def.Token).Default().(string)
	if keyring.Token != nil {
		access.token = keyring.Token.Value().(string)
	}

	access.hostName = new(def.HostName).Default().(string)
	if yml.HostName != nil {
		access.hostName = yml.HostName.Value().(string)
	}
	if envar.HostName != nil {
		access.hostName = envar.HostName.Value().(string)
	}

	access.dryRun = new(def.DryRun).Default().(bool)
	if envar.DryRun != nil {
		access.dryRun = envar.DryRun.Value().(bool)
	}

	return
}

type Access struct {
	token    string
	hostName string
	dryRun   bool
}

func (a *Access) Token() string {
	return a.token
}

func (a *Access) HostName() string {
	return a.hostName
}

func (a *Access) DryRun() bool {
	return a.dryRun
}
